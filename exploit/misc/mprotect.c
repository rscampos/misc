#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>
#include <sys/mman.h>

unsigned long get_esp(void) {
	__asm__("movl %esp,%eax");
}

main(){
	unsigned int addr, page, pagesize;
	pagesize = sysconf(_SC_PAGE_SIZE);
	addr = get_esp();
	page = addr & 0xFFFFF000;
	printf("esp addr:%p - pid:%d\n",addr, getpid());
	printf("Press <ENTER> to modify protection on page:%p...\n", page);
	getchar();
	mprotect(page,pagesize,PROT_EXEC|PROT_WRITE|PROT_READ);
	printf("Protection modified.\n");
	getchar();
}
