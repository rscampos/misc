/* Tool for change a given offset to NOP instruction (0x90). 
 * Used for overwrite a conditional jump used in canary protection,
 * disabling it.
 */
#include <stdio.h>
#include <stdlib.h>

void main(int argc, char *argv[]){
	FILE *fd;
	unsigned char byte_old=0x00, byte_new=0x90;
	int offset;
	
	if(argc < 3){
		printf("Replace with nop\n");
		printf("Usage: %s file offset\n", argv[0]);
		exit(0);
	}

	offset = atoi(argv[2]);

	fd = fopen(argv[1],"r+b");
	if(fd){
		fseek(fd, offset, SEEK_SET);
		fread(&byte_old, 1, 1, fd);

		fseek(fd, offset, SEEK_SET);
		fwrite(&byte_new, 1, 1, fd);

		printf("Replacing byte:0x%x at offset:%d with:0x%x\n", byte_old, offset, byte_new);
	}	
	fclose(fd);	
}
