#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <string.h>

#define DEVICE "/dev/vulndrive"
void print_hex_dump(const char *buffer, int size){
	int i;
	printf("00: ");
	for(i=0; i<size; i++){
		printf("0x%.2x ", (unsigned char) *(buffer+i));
		if(((i+1) % 8 == 0) && i >0)
			printf("\n%.2d: ", i+1);
	}
	printf("\n");

}
int main(int argc, char **argv){
        int size, fd,  ret;
        char ch, write_buf[100], read_buf[100];
	
	/* open for read/write */
        fd = open(DEVICE, O_RDONLY); 
        if(fd == -1){
                printf("Error!\n");
                exit(1);
        }

        printf("r = read from device\nw = write to device\nenter cmd: ");
        scanf("%c", &ch);
        
	printf("Size: ");
        scanf("%d", &size);

        switch(ch){
                case 'w':
                        printf("[+] Data: ");
                        scanf(" %[^\n]",write_buf);
                        ret = write(fd, write_buf, size);
                        printf("[+] Write's return :%d\n", ret);
                        break;
                case 'r':
                        ret = read(fd, read_buf, size);
                        printf("[+] Read's return :%d\n", ret);
                        printf("[+] DATA :%s\n",read_buf);
			print_hex_dump(read_buf, 64);

			lseek(fd, 16, SEEK_CUR); 
                        ret = read(fd, read_buf, size);
                        printf("[+] Read's return :%d\n", ret);
			print_hex_dump(read_buf, 64);
			//ret = read(fd, read_buf, size);
                        //printf("[+] Read's return :%d\n", ret);
                        //printf("[+] DATA :%s\n",read_buf);

                        break;
                default:
                        printf("Cmd not recognized\n");
        }
        close(fd);
        return 0;
}
